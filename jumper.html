<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Vertical Jumper — Clean Tap‑to‑Start</title>
<style>
  :root{ --ink:#eaf2ff; --mut:#9fb0d9; --bg1:#0b0f1c; --bg2:#141b37; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0; background:radial-gradient(1200px 800px at 25% -10%, var(--bg2), var(--bg1)); color:var(--ink); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  #game{position:fixed; inset:0}
  .hud{position:fixed; left:0; right:0; top:0; display:flex; justify-content:space-between; padding:10px; z-index:2}
  .chip{background:linear-gradient(180deg,#1e2750,#12193a); border:1px solid #2a3366; padding:8px 12px; border-radius:999px; font-weight:800; font-size:14px}
  .btn{background:linear-gradient(180deg,#2b3568,#1a2447); border:1px solid #3a4683; padding:8px 12px; border-radius:12px; color:#fff; font-weight:800; cursor:pointer}
  /* Tap-to-start overlay */
  #startOverlay{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(6,9,20,.58); backdrop-filter:blur(4px); z-index:5}
  .bubble{padding:18px 26px; border-radius:16px; background:linear-gradient(180deg,#1b2148,#121a36); border:1px solid #2b3566; box-shadow:0 18px 48px rgba(0,0,0,.55); font-weight:900; letter-spacing:.4px; text-align:center}
  .bubble .hint{margin-top:8px; color:var(--mut); font-weight:700; font-size:12px}
</style>
</head>
<body>
  <canvas id="game"></canvas>
  <div class="hud">
    <div class="chip">Height: <span id="height">0</span> m</div>
    <div style="display:flex; gap:8px">
      <div class="chip">Coins: <span id="coins">0</span></div>
      <button id="btnRestart" class="btn">Restart</button>
    </div>
  </div>
  <div id="startOverlay">
    <div class="bubble">TAP TO START<div class="hint">Tap anywhere • Arrows/A–D on desktop</div></div>
  </div>

  <!-- small SFX (replace if you want) -->
  <audio id="s-coin" preload="auto"><source src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA" type="audio/mp3"></audio>

<script>
(function(){
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const heightEl = document.getElementById('height');
  const coinsEl = document.getElementById('coins');
  const startOverlay = document.getElementById('startOverlay');
  const btnRestart = document.getElementById('btnRestart');
  const coinS = document.getElementById('s-coin');

  let W=0,H=0,DPR=1; let running=false; let audioOn=false;

  // Tuned, easier physics + tighter gaps
  const G=0.30, JUMP=9.8, MOVE=0.22, AIR=0.985, MAX_VX=5.2;
  const PLATFORM_W=[80,120];          // width range
  const PLATFORM_GAP=[50,80];          // **tighter** vertical gaps

  const WORLD={cameraY:0, bestY:0, coins:0};
  const INPUT={left:false, right:false};
  const PLAYER={x:0, y:0, vx:0, vy:-8, r:18, alive:true};

  let platforms=[]; // {x,y,w,h,type}
  let coins=[];     // {x,y,r,t}

  function resize(){
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio||1));
    W = Math.floor(innerWidth); H = Math.floor(innerHeight);
    canvas.width = Math.floor(W*DPR); canvas.height = Math.floor(H*DPR);
    canvas.style.width=W+'px'; canvas.style.height=H+'px';
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }

  function randBetween(a,b){ return a + Math.random()*(b-a); }

  function makePlatform(y){
    const w = randBetween(PLATFORM_W[0], PLATFORM_W[1]);
    const x = Math.random()*(W-w);
    return {x,y,w,h:12,type:'normal'};
  }

  function reset(){
    WORLD.cameraY=0; WORLD.bestY=0; WORLD.coins=0; coinsEl.textContent=0;
    PLAYER.x=W/2; PLAYER.y=H-100; PLAYER.vx=0; PLAYER.vy=-8; PLAYER.alive=true;
    platforms.length=0; coins.length=0;
    // Seed many safe platforms near start
    let y=H-40;
    for(let i=0;i<26;i++){
      const p=makePlatform(y);
      if(i<6){ p.w=120; p.x=Math.max(20, Math.min(W-140, W/2-60 + (i%2?-40:40))); }
      platforms.push(p);
      if(Math.random()<0.55) coins.push({x:p.x+p.w/2, y:y-22, r:8, t:Math.random()*6});
      y -= randBetween(PLATFORM_GAP[0], PLATFORM_GAP[1]);
    }
  }

  function spawnRow(){
    const highestY = platforms.reduce((m,p)=>Math.min(m,p.y), Infinity);
    const ny = highestY - randBetween(PLATFORM_GAP[0], PLATFORM_GAP[1]);
    const p = makePlatform(ny);
    platforms.push(p);
    if(Math.random()<0.55) coins.push({x:p.x+p.w/2, y:ny-22, r:8, t:Math.random()*6});
  }

  // Input
  addEventListener('keydown', e=>{ if(['ArrowLeft','a','A'].includes(e.key)) INPUT.left=true; if(['ArrowRight','d','D'].includes(e.key)) INPUT.right=true; });
  addEventListener('keyup', e=>{ if(['ArrowLeft','a','A'].includes(e.key)) INPUT.left=false; if(['ArrowRight','d','D'].includes(e.key)) INPUT.right=false; });

  // Start game (simple, reliable)
  function start(){ if(running) return; running=true; audioOn=true; startOverlay.remove(); }
  startOverlay.addEventListener('click', start, {once:true});
  window.addEventListener('keydown', start, {once:true});
  // Fallback in case overlay click is blocked
  setTimeout(()=>{ if(!running) start(); }, 4000);

  btnRestart.addEventListener('click', ()=>{ reset(); running=true; });

  function update(dt){
    // horizontal control
    const lr=(INPUT.left?-1:0)+(INPUT.right?1:0);
    PLAYER.vx += lr*MOVE*dt*60; PLAYER.vx *= AIR; if(PLAYER.vx>MAX_VX)PLAYER.vx=MAX_VX; if(PLAYER.vx<-MAX_VX)PLAYER.vx=-MAX_VX;
    // gravity
    PLAYER.vy += G*dt*60; PLAYER.x += PLAYER.vx*dt*60; PLAYER.y += PLAYER.vy*dt*60;
    if(PLAYER.x<-20) PLAYER.x=W+20; else if(PLAYER.x>W+20) PLAYER.x=-20;

    // collide (when falling)
    if(PLAYER.vy>0){
      for(const p of platforms){
        const onY = (PLAYER.y+PLAYER.r>=p.y && PLAYER.y+PLAYER.r <= p.y+p.h+Math.abs(PLAYER.vy)+2);
        const onX = (PLAYER.x > p.x-PLAYER.r*0.7 && PLAYER.x < p.x+p.w+PLAYER.r*0.7);
        if(onY && onX){ PLAYER.vy = -JUMP; PLAYER.y = p.y-PLAYER.r; }
      }
    }

    // spawn/cull
    platforms = platforms.filter(p=>p.y < WORLD.cameraY + H + 80);
    while(platforms.length<24) spawnRow();

    // camera follows upward
    if(PLAYER.y < WORLD.cameraY + H*0.45) WORLD.cameraY = PLAYER.y - H*0.45;
    if(PLAYER.y < WORLD.bestY) WORLD.bestY = PLAYER.y;

    // coins
    for(const c of coins){
      const dx=PLAYER.x-c.x, dy=PLAYER.y-c.y; if(dx*dx+dy*dy < (PLAYER.r+c.r)*(PLAYER.r+c.r)){
        c.y = WORLD.cameraY + H + 100; WORLD.coins++; coinsEl.textContent=WORLD.coins; if(audioOn){ coinS.currentTime=0; coinS.play().catch(()=>{});} }
      c.t += dt;
    }

    // fail if you drop below screen
    if(PLAYER.y - WORLD.cameraY > H + 60){ reset(); running=false; // show start again
      document.body.appendChild(startOverlay); startOverlay.style.display='flex'; setTimeout(()=>{ running=true; startOverlay.style.display='none'; }, 300); // auto resume quickly
    }
  }

  function draw(){
    // background
    const g = ctx.createLinearGradient(0,0,0,H); g.addColorStop(0,'#18204a'); g.addColorStop(1,'#0a0f24'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    // platforms
    ctx.strokeStyle='#40509a'; ctx.lineWidth=2; ctx.fillStyle='#203064';
    for(const p of platforms){ const yy=p.y-WORLD.cameraY; roundRect(ctx,p.x,yy,p.w,p.h,10,true,true); }
    // coins
    ctx.fillStyle='#ffd86a'; ctx.strokeStyle='#7a4e05';
    for(const c of coins){ const yy=c.y-WORLD.cameraY; const r=c.r + Math.sin(c.t*6)*1.2; ctx.beginPath(); ctx.arc(c.x,yy,r,0,Math.PI*2); ctx.fill(); ctx.lineWidth=2; ctx.stroke(); }
    // player
    const px=PLAYER.x, py=PLAYER.y-WORLD.cameraY, r=PLAYER.r;
    const grad=ctx.createRadialGradient(px-r*0.4,py-r*0.6,r*0.2,px,py,r*1.2); grad.addColorStop(0,'#ff6ec4'); grad.addColorStop(1,'#7a3df2'); ctx.fillStyle=grad; ctx.strokeStyle='#ffffff33'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(px,py,r,0,Math.PI*2); ctx.fill(); ctx.stroke();
    ctx.fillStyle='#0b0f1c'; ctx.beginPath(); ctx.arc(px-r*0.35, py-r*0.2, r*0.18, 0, Math.PI*2); ctx.arc(px+r*0.35, py-r*0.2, r*0.18, 0, Math.PI*2); ctx.fill();

    // HUD
    const meters = Math.max(0, Math.round(-(WORLD.bestY - (H-80)) / 10)); heightEl.textContent = meters;
  }

  function roundRect(ctx,x,y,w,h,r,fill,stroke){
    if (typeof r === 'number') r = {tl:r,tr:r,br:r,bl:r};
    ctx.beginPath(); ctx.moveTo(x+r.tl,y); ctx.lineTo(x+w-r.tr,y); ctx.quadraticCurveTo(x+w,y,x+w,y+r.tr);
    ctx.lineTo(x+w,y+h-r.br); ctx.quadraticCurveTo(x+w,y+h,x+w-r.br,y+h); ctx.lineTo(x+r.bl,y+h);
    ctx.quadraticCurveTo(x,y+h,x,y+h-r.bl); ctx.lineTo(x,y+r.tl); ctx.quadraticCurveTo(x,y,x+r.tl,y); ctx.closePath();
    if(fill) ctx.fill(); if(stroke) ctx.stroke();
  }

  let last=0; function loop(t){ const dt=Math.min(0.04,(t-last)/1000||0.016); last=t; if(running) update(dt); draw(); requestAnimationFrame(loop); }

  // init
  resize(); reset(); draw();
  addEventListener('resize', resize);
  requestAnimationFrame(loop);
})();
</script>
</body>
</html>
